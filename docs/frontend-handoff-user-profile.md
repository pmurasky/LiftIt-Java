# Frontend Handoff — User Profile API

**Prepared for:** Frontend AI agent (OpenCode + Claude Sonnet)
**Date:** 2026-02-21
**Backend stack:** Java 25, Spring Boot 4, PostgreSQL, Auth0

---

## Authentication

The backend uses Auth0 as the sole identity provider. The frontend must include a valid
Auth0 JWT access token on every request:

```
Authorization: Bearer <access_token>
```

The backend **never issues, stores, or accepts passwords**. Auth0 owns all credentials.

---

## What Is Live Today

### User Provisioning
`POST /api/v1/users/me`

Call this once on first login to register the user in the backend database.

**Request body:**
```json
{
  "auth0Id": "auth0|abc123",
  "email": "alice@example.com"
}
```

**Success — 201 Created:**
```json
{
  "id": 100,
  "auth0Id": "auth0|abc123",
  "email": "alice@example.com",
  "createdAt": "2026-02-21T12:00:00Z"
}
```

**Error responses:**

| Status | Meaning |
|--------|---------|
| `400 Bad Request` | `auth0Id` or `email` is missing or blank |
| `409 Conflict` | User with this `auth0Id` or `email` already exists |

---

## What Is NOT Yet Live (Coming Soon)

The `user_profiles` table and domain model exist in the backend but **there is no
API endpoint yet**. The frontend cannot create or fetch a profile until the next
issue is complete.

When built, the endpoints will be:

---

### Create Profile
`POST /api/v1/users/me/profile`

**Request body:**
```json
{
  "username": "alice_lifts",
  "displayName": "Alice Smith",
  "gender": "female",
  "birthdate": "1990-06-15",
  "heightCm": 165.0,
  "unitsPreference": "metric"
}
```

**Field rules:**

| Field | Required | Type | Constraints |
|-------|----------|------|-------------|
| `username` | Yes | string | 1–30 chars, unique across all users |
| `displayName` | No | string | Max 100 chars, may be null/omitted |
| `gender` | No | string | `male`, `female`, `non_binary`, `prefer_not_to_say`, or null |
| `birthdate` | No | string | ISO 8601 date — `YYYY-MM-DD`, or null |
| `heightCm` | No | number | Decimal, always in centimetres regardless of preference, or null |
| `unitsPreference` | Yes | string | `metric` or `imperial` — defaults to `metric` |

**Success — 201 Created:**
```json
{
  "id": 1,
  "userId": 100,
  "username": "alice_lifts",
  "displayName": "Alice Smith",
  "gender": "female",
  "birthdate": "1990-06-15",
  "heightCm": 165.0,
  "unitsPreference": "metric",
  "createdAt": "2026-02-21T12:00:00Z"
}
```

---

### Get Profile
`GET /api/v1/users/me/profile`

Returns the profile for the authenticated user.

**Success — 200 OK:** same shape as the create response above.

**Error responses:**

| Status | Meaning |
|--------|---------|
| `404 Not Found` | User has not created a profile yet — show onboarding |

---

## Key Design Decisions

| Decision | Detail |
|----------|--------|
| **No password fields — ever** | Auth0 owns auth. The backend never stores or accepts passwords |
| **`username` is user-supplied** | Required at profile creation. Not auto-generated by the backend |
| **No `body_weight_kg` on profile** | Weight is time-series data tracked separately in `body_weight_history`. The profile has no weight field |
| **Heights always stored in cm** | Even when the user prefers imperial. The UI is responsible for conversion and display |
| **`unitsPreference`** | `metric` or `imperial` only. The backend always stores measurements in metric units |
| **Profile is 1-to-1 with user** | One user can have exactly one profile. Cannot create two |
| **Optional fields are truly optional** | `displayName`, `gender`, `birthdate`, `heightCm` may all be null or omitted from the request |

---

## Recommended Frontend Flow

```
1. User signs in via Auth0 SDK
2. Frontend calls POST /api/v1/users/me  (user provisioning)
      - 201 → user created, continue
      - 409 → user already exists, continue
3. Frontend calls GET /api/v1/users/me/profile
      - 200 → profile exists, go to main app
      - 404 → no profile yet, show onboarding screen
4. Onboarding screen collects: username (required) + optional fields
5. Frontend calls POST /api/v1/users/me/profile
      - 201 → profile created, go to main app
      - 400 → validation error, show field errors
      - 409 → username taken, prompt for a different one
```

---

## Notes for the AI Agent

- All timestamps are **UTC**, ISO 8601 format: `2026-02-21T12:00:00Z`
- All measurements are **metric** on the wire — convert for display only
- `gender` is a free-ish string validated server-side — do not invent new values beyond those listed
- `birthdate` is a **date only** (no time component) — send as `YYYY-MM-DD`
- The backend is **stateless** — no cookies, no sessions. Always send the Bearer token
